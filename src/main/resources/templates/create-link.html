<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="page-title">urlto - T·∫°o Link</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Color+Emoji&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            background: linear-gradient(180deg, #0d1117 0%, #1a202c 100%);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            color: #c9d1d9;
        }

        /* Apply Noto Color Emoji to specific elements or globally if needed */
        .language-item span {
            font-family: 'Noto Color Emoji', 'Inter', sans-serif;
            /* Prioritize Noto Color Emoji for flags */
            font-size: 1.5em;
            /* Make emoji flags larger */
        }

        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }

        .no-scrollbar {
            -ms-overflow-style: none;
            /* IE and Edge */
            scrollbar-width: none;
            /* Firefox */
        }

        /* Navbar and Dropdown styles from index.html */
        .mobile-menu-transition {
            transition: transform 0.3s ease-out, opacity 0.3s ease-out;
            transform: translateY(-100%);
            opacity: 0;
            pointer-events: none;
        }

        .mobile-menu-transition.is-active {
            transform: translateY(0);
            opacity: 1;
            pointer-events: auto;
        }

        .dropdown-transition {
            display: none;
            /* Hidden by default */
            max-height: 0;
            opacity: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out, opacity 0.3s ease-out;
            /* Still allow visual transition */
        }

        .dropdown-transition.is-active {
            display: block;
            /* Instantly visible and interactive */
            max-height: 200px;
            /* Adjust based on content height */
            opacity: 1;
        }

        /* Custom styles for professional dashboard look */
        .dashboard-card {
            background-color: #1a202c;
            /* Darker background for cards, similar to login form container */
            border: 1px solid #2d3748;
            /* Subtle border, similar to input fields */
            color: #e2e8f0;
            /* Text color inside cards */
        }

        input,
        select,
        textarea {
            background-color: #2d3748;
            /* Tailwind: bg-gray-700 */
            color: #e2e8f0;
            /* Tailwind: text-gray-200 */
            border: 1px solid #4a5568;
            /* Tailwind: border-gray-600 */
            border-radius: 0.5rem;
            /* Tailwind: rounded-md */
            padding: 0.75rem 1rem;
            /* Tailwind: py-3 px-4 */
            width: 100%;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: #4299e1;
            /* Tailwind: border-blue-500 */
            box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.5);
            /* Tailwind: ring-2 ring-blue-500 */
        }

        button {
            transition: background-color 0.2s ease-in-out, transform 0.2s;
        }

        .bg-blue-600 {
            /* Primary button color */
            background-color: #4299e1;
            /* Tailwind: bg-blue-500 */
        }

        .bg-blue-600:hover {
            background-color: #3182ce;
            /* Tailwind: hover:bg-blue-600 */
            transform: translateY(-2px);
            /* Simple hover effect */
        }

        .bg-blue-600:active {
            transform: translateY(0);
        }

        .error-message {
            background-color: rgba(239, 68, 68, 0.1);
            color: #ef4444;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
        }

        .success-message {
            background-color: rgba(34, 197, 94, 0.1);
            color: #22c55e;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
        }
    </style>
</head>

<body class="bg-gray-900 text-gray-100 min-h-screen flex flex-col">

    <nav class="relative z-10 flex items-center justify-between p-4 md:p-6 lg:px-12 bg-gray-900 shadow-md">
        <div class="flex items-center space-x-2">
            <button id="mobile-menu-button"
                class="text-white focus:outline-none md:hidden p-2 rounded-md hover:bg-white hover:bg-opacity-20 transition-all duration-200">
                <i class="fas fa-bars text-2xl"></i>
            </button>
            <span id="site-name" class="text-xl md:text-2xl font-bold text-white">urlto</span>
        </div>

        <div class="hidden md:flex items-center space-x-6">
            <a href="#" id="nav-dashboard" data-i18n-key="dashboard"
                class="text-white hover:text-blue-300 transition-colors duration-200 font-medium px-2 py-1 rounded-md hover:bg-white hover:bg-opacity-10">B·∫¢NG
                ƒêI·ªÄU KHI·ªÇN</a>
            <a href="#" id="nav-create-link" data-i18n-key="tao-link-moi"
                class="text-white hover:text-blue-300 transition-colors duration-200 font-medium px-2 py-1 rounded-md hover:bg-white hover:bg-opacity-10">T·∫†O
                LINK M·ªöI</a>
            <a href="#" id="nav-manage-links" data-i18n-key="quan-ly-link"
                class="text-white hover:text-blue-300 transition-colors duration-200 font-medium px-2 py-1 rounded-md hover:bg-white hover:bg-opacity-10">QU·∫¢N
                L√ù LINK</a>
            <a href="#" id="nav-payout-rates" data-i18n-key="ty-gia-thanh-toan"
                class="text-white hover:text-blue-300 transition-colors duration-200 font-medium px-2 py-1 rounded-md hover:bg-white hover:bg-opacity-10">T·ª∂
                GI√Å THANH TO√ÅN</a>
            <a href="#" id="nav-statistics" data-i18n-key="thong-ke"
                class="text-white hover:text-blue-300 transition-colors duration-200 font-medium px-2 py-1 rounded-md hover:bg-white hover:bg-opacity-10">TH·ªêNG
                K√ä</a>
            <a href="#" id="nav-settings" data-i18n-key="cai-dat"
                class="text-white hover:text-blue-300 transition-colors duration-200 font-medium px-2 py-1 rounded-md hover:bg-white hover:bg-opacity-10">C√ÄI
                ƒê·∫∂T</a>

            <div class="relative">
                <button id="language-button-desktop"
                    class="text-white text-lg cursor-pointer hover:text-blue-300 transition-colors duration-200 focus:outline-none p-2 rounded-md hover:bg-white hover:bg-opacity-20">
                    <i class="fas fa-globe"></i>
                </button>
                <div id="language-dropdown-desktop"
                    class="absolute top-full right-0 mt-2 w-48 bg-gray-800 rounded-md shadow-lg z-30 dropdown-transition">
                    <a href="#"
                        class="flex items-center gap-2 px-4 py-2 text-white hover:bg-gray-700 rounded-t-md language-item"
                        data-lang="vi">
                        <span role="img" aria-label="Vietnam Flag">üáªüá≥</span> Ti·∫øng Vi·ªát
                    </a>
                    <a href="#"
                        class="flex items-center gap-2 px-4 py-2 text-white hover:bg-gray-700 rounded-b-md language-item"
                        data-lang="en">
                        <span role="img" aria-label="USA Flag">üá∫üá∏</span> English
                    </a>
                </div>
            </div>
            <a href="#" id="nav-logout" data-i18n-key="dang-xuat"
                class="bg-red-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-red-700 transition-all duration-200 shadow-md transform hover:scale-105">ƒêƒÇNG
                XU·∫§T</a>
        </div>
    </nav>

    <div id="mobile-menu"
        class="fixed inset-0 bg-gray-900 bg-opacity-95 p-6 z-20 flex flex-col items-center justify-center mobile-menu-transition">
        <div class="absolute top-4 right-4">
            <button id="close-mobile-menu-button"
                class="text-white focus:outline-none p-2 rounded-md hover:bg-white hover:bg-opacity-20 transition-all duration-200">
                <i class="fas fa-times text-2xl"></i>
            </button>
        </div>
        <div class="flex flex-col space-y-6 text-center w-full max-w-sm">
            <a href="#" id="mobile-nav-dashboard" data-i18n-key="dashboard"
                class="text-white text-xl font-medium py-2 rounded-md hover:bg-gray-800 transition-colors duration-200">B·∫¢NG
                ƒêI·ªÄU KHI·ªÇN</a>
            <a href="#" id="mobile-nav-create-link" data-i18n-key="tao-link-moi"
                class="text-white text-xl font-medium py-2 rounded-md hover:bg-gray-800 transition-colors duration-200">T·∫†O
                LINK M·ªöI</a>
            <a href="#" id="mobile-nav-manage-links" data-i18n-key="quan-ly-link"
                class="text-white text-xl font-medium py-2 rounded-md hover:bg-gray-800 transition-colors duration-200">QU·∫¢N
                L√ù LINK</a>
            <a href="#" id="mobile-nav-payout-rates" data-i18n-key="ty-gia-thanh-toan"
                class="text-white text-xl font-medium py-2 rounded-md hover:bg-gray-800 transition-colors duration-200">T·ª∂
                GI√Å THANH TO√ÅN</a>
            <a href="#" id="mobile-nav-statistics" data-i18n-key="thong-ke"
                class="text-white text-xl font-medium py-2 rounded-md hover:bg-gray-800 transition-colors duration-200">TH·ªêNG
                K√ä</a>
            <a href="#" id="mobile-nav-settings" data-i18n-key="cai-dat"
                class="text-white text-xl font-medium py-2 rounded-md hover:bg-gray-800 transition-colors duration-200">C√ÄI
                ƒê·∫∂T</a>

            <div class="relative w-max mx-auto">
                <button id="language-button-mobile"
                    class="text-white text-xl cursor-pointer hover:text-blue-300 transition-colors duration-200 mt-4 focus:outline-none py-2 px-4 rounded-md hover:bg-gray-800 flex items-center gap-2">
                    <i class="fas fa-globe"></i> <span data-i18n-key="language-mobile-text">Ng√¥n ng·ªØ</span>
                </button>
                <div id="language-dropdown-mobile"
                    class="absolute w-full bg-gray-800 rounded-md shadow-inner text-center mt-2 dropdown-transition">
                    <a href="#"
                        class="flex items-center justify-center gap-2 px-4 py-2 text-white hover:bg-gray-700 language-item"
                        data-lang="vi">
                        <span role="img" aria-label="Vietnam Flag">üáªüá≥</span> Ti·∫øng Vi·ªát
                    </a>
                    <a href="#"
                        class="flex items-center justify-center gap-2 px-4 py-2 text-white hover:bg-gray-700 language-item"
                        data-lang="en">
                        <span role="img" aria-label="USA Flag">üá∫üá∏</span> English
                    </a>
                </div>
            </div>
            <a href="#" id="mobile-nav-logout" data-i18n-key="dang-xuat"
                class="bg-red-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-red-700 transition-all duration-200 shadow-md w-max mx-auto transform hover:scale-105">ƒêƒÇNG
                XU·∫§T</a>
        </div>
    </div>


    <div class="flex-grow p-6 lg:p-8">
        <h1 class="text-3xl font-bold mb-8 text-white" data-i18n-key="tao-link-rut-gon-moi">T·∫°o Link R√∫t G·ªçn M·ªõi</h1>

        <div class="dashboard-card p-6 rounded-lg shadow-md mb-8">
            <div class="mb-4">
                <label for="longUrl" class="block text-gray-300 text-sm font-bold mb-2">
                    URL G·ªëc <span class="text-red-500">*</span>
                </label>
                <input type="url" id="longUrl" placeholder="V√≠ d·ª•: https://long-example.com/very-long-path" required
                    class="input-field" />
            </div>
            <div class="mb-6">
                <label for="customShortCode" class="block text-gray-300 text-sm font-bold mb-2">
                    M√£ R√∫t G·ªçn T√πy Ch·ªânh (T√π ch·ªçn)
                </label>
                <input type="text" id="customShortCode" placeholder="V√≠ d·ª•: link-cua-toi" class="input-field" />
            </div>
            <div class="flex items-center justify-between mb-4">
                <button id="shortenButton"
                    class="bg-blue-600 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline transition-colors duration-200 w-full disabled:opacity-50 disabled:cursor-not-allowed">
                    <i class="fas fa-compress-alt mr-2"></i> R√∫t G·ªçn Link
                </button>
            </div>
            <div id="loadingIndicator" class="text-blue-400 text-center mt-2" style="display: none;">
                <i class="fas fa-spinner fa-spin mr-2"></i> ƒêang x·ª≠ l√Ω...
            </div>
            <div id="errorMessage" class="error-message text-red-400 mt-4 text-center" style="display: none;">
            </div>
            <div id="successMessage" class="success-message text-green-400 mt-4" style="display: none;">
                <p class="font-bold mb-2">Link c·ªßa b·∫°n ƒë√£ ƒë∆∞·ª£c r√∫t g·ªçn th√†nh c√¥ng!</p>
                <div class="flex items-center space-x-2">
                    <input type="text" id="shortenedUrlOutput" readonly
                        class="flex-grow py-2 px-3 bg-gray-700 border border-gray-600 rounded text-white cursor-pointer"
                        onclick="this.select();" />
                    <button id="copyButton"
                        class="bg-gray-700 hover:bg-gray-600 text-white font-bold py-2 px-3 rounded transition-colors duration-200">
                        <i class="fas fa-copy"></i> Sao ch√©p
                    </button>
                </div>
            </div>
        </div>
    </div>

    <footer class="bg-black text-white py-10 px-4">
        <div class="container mx-auto text-center md:flex md:justify-between md:items-center">
            <p class="mb-4 md:mb-0 text-gray-400" data-i18n-key="copyright">&copy; 2025 <span
                    id="footer-site-name">urlto</span>. T·∫•t c·∫£ c√°c quy·ªÅn ƒë∆∞·ª£c b·∫£o
                l∆∞u.</p>
            <div class="flex justify-center space-x-6">
                <a href="#" class="hover:text-blue-300 transition-colors duration-200 text-gray-400"
                    data-i18n-key="privacy-policy">Ch√≠nh s√°ch b·∫£o m·∫≠t</a>
                <a href="#" class="hover:text-blue-300 transition-colors duration-200 text-gray-400"
                    data-i18n-key="terms-of-service">ƒêi·ªÅu kho·∫£n d·ªãch v·ª•</a>
                <a href="#" class="hover:text-blue-300 transition-colors duration-200 text-gray-400"
                    data-i18n-key="contact">Li√™n h·ªá</a>
            </div>
            <div class="mt-4 md:mt-0">
                <p class="text-gray-500 text-sm">
                    <span data-i18n-key="developed-by">Ph√°t tri·ªÉn b·ªüi</span>
                    <a id="author-link" href="#" target="_blank"
                        class="text-blue-400 hover:text-blue-300 transition-colors duration-200">
                        <span id="github-name">ShyDev</span>
                    </a>
                </p>
            </div>
        </div>
    </footer>

    <script>
        // Global variables for backend URL and app info
        let backendUrl = '';
        let appInfo = {};
        let currentLang = 'vi'; // Default language

        // Map of translatable elements and their translations
        const translatableElements = {
            'dashboard': {
                'vi': 'B·∫¢NG ƒêI·ªÄU KHI·ªÇN',
                'en': 'DASHBOARD'
            },
            'tao-link-moi': { // New translation key for "Create Link"
                'vi': 'T·∫†O LINK M·ªöI',
                'en': 'CREATE LINK'
            },
            'quan-ly-link': {
                'vi': 'QU·∫¢N L√ù LINK',
                'en': 'MANAGE LINKS'
            },
            'ty-gia-thanh-toan': {
                'vi': 'T·ª∂ GI√Å THANH TO√ÅN',
                'en': 'PAYOUT RATES'
            },
            'thong-ke': {
                'vi': 'TH·ªêNG K√ä',
                'en': 'STATISTICS'
            },
            'cai-dat': {
                'vi': 'C√ÄI ƒê·∫∂T',
                'en': 'SETTINGS'
            },
            'dang-xuat': {
                'vi': 'ƒêƒÇNG XU·∫§T',
                'en': 'LOGOUT'
            },
            'tao-link-rut-gon-moi': {
                'vi': 'T·∫°o Link R√∫t G·ªçn M·ªõi',
                'en': 'Create New Short Link'
            },
            'url-goc': {
                'vi': 'URL G·ªëc',
                'en': 'Original URL'
            },
            'ma-rut-gon-tuy-chinh': {
                'vi': 'M√£ R√∫t G·ªçn T√πy Ch·ªânh (T√πy ch·ªçn)',
                'en': 'Custom Short Code (Optional)'
            },
            'rut-gon-link': {
                'vi': 'R√∫t G·ªçn Link',
                'en': 'Shorten Link'
            },
            'dang-xu-ly': {
                'vi': 'ƒêang x·ª≠ l√Ω...',
                'en': 'Processing...'
            },
            'link-cua-ban-da-duoc-rut-gon': {
                'vi': 'Link c·ªßa b·∫°n ƒë√£ ƒë∆∞·ª£c r√∫t g·ªçn th√†nh c√¥ng!',
                'en': 'Your link has been shortened successfully!'
            },
            'sao-chep': {
                'vi': 'Sao ch√©p',
                'en': 'Copy'
            },
            'vui-long-nhap-url-goc': {
                'vi': 'Vui l√≤ng nh·∫≠p URL g·ªëc.',
                'en': 'Please enter the original URL.'
            },
            'url-goc-khong-hop-le': {
                'vi': 'URL g·ªëc kh√¥ng h·ª£p l·ªá. Vui l√≤ng nh·∫≠p ƒë√∫ng ƒë·ªãnh d·∫°ng (v√≠ d·ª•: https://example.com).',
                'en': 'Invalid original URL. Please enter a valid format (e.g., https://example.com).'
            },
            'da-xay-ra-loi-khong-xac-dinh': {
                'vi': 'ƒê√£ x·∫£y ra l·ªói kh√¥ng x√°c ƒë·ªãnh. Vui l√≤ng th·ª≠ l·∫°i.',
                'en': 'An unknown error occurred. Please try again.'
            },
            'khong-the-ket-noi-den-may-chu': {
                'vi': 'Kh√¥ng th·ªÉ k·∫øt n·ªëi ƒë·∫øn m√°y ch·ªß. Vui l√≤ng ki·ªÉm tra k·∫øt n·ªëi m·∫°ng ho·∫∑c th·ª≠ l·∫°i sau.',
                'en': 'Cannot connect to the server. Please check your network connection or try again later.'
            },
            'da-rut-gon-link-nhung-khong-tim-thay-shortcode': {
                'vi': 'ƒê√£ r√∫t g·ªçn link nh∆∞ng kh√¥ng t√¨m th·∫•y shortcode trong ph·∫£n h·ªìi. Vui l√≤ng ki·ªÉm tra console.',
                'en': 'Link shortened but shortcode not found in response. Please check the console.'
            },
            // Added from index.html/login.html for consistency
            'copyright': {
                'vi': `&copy; 2025 %WEB_NAME%. T·∫•t c·∫£ c√°c quy·ªÅn ƒë∆∞·ª£c b·∫£o l∆∞u.`,
                'en': `&copy; 2025 %WEB_NAME%. All rights reserved.`
            },
            'privacy-policy': {
                'vi': 'Ch√≠nh s√°ch b·∫£o m·∫≠t',
                'en': 'Privacy Policy'
            },
            'terms-of-service': {
                'vi': 'ƒêi·ªÅu kho·∫£n d·ªãch v·ª•',
                'en': 'Terms of Service'
            },
            'contact': {
                'vi': 'Li√™n h·ªá',
                'en': 'Contact'
            },
            'language-mobile-text': {
                'vi': 'Ng√¥n ng·ªØ',
                'en': 'Language'
            },
            'developed-by': {
                'vi': 'Ph√°t tri·ªÉn b·ªüi',
                'en': 'Developed by'
            },
        };

        // Function to apply translations
        function translatePage(lang) {
            currentLang = lang; // Update current language global variable
            document.documentElement.lang = lang; // Update HTML lang attribute
            localStorage.setItem('preferredLang', lang); // L∆∞u ng√¥n ng·ªØ v√†o localStorage

            for (const key in translatableElements) {
                const elements = document.querySelectorAll(`[data-i18n-key="${key}"]`);
                elements.forEach(element => {
                    if (translatableElements[key] && translatableElements[key][lang]) {
                        let text = translatableElements[key][lang];
                        // Replace %WEB_NAME% placeholder with actual appInfo.webName
                        if (appInfo.webName) {
                            text = text.replace(/%WEB_NAME%/g, appInfo.webName);
                        } else {
                            // Fallback if appInfo.webName is not yet available
                            text = text.replace(/%WEB_NAME%/g, 'urlto');
                        }

                        if (element.tagName === 'INPUT' && element.getAttribute('placeholder') !== null) {
                            element.placeholder = text;
                        } else {
                            element.innerHTML = text;
                        }
                    }
                });
            }

            const titleBase = lang === 'vi' ? 'T·∫°o Link' : 'Create Link';
            document.getElementById('page-title').textContent = `${appInfo.webName || 'urlto'} - ${titleBase}`;
        }

        // API functions to fetch backend info
        async function fetchBackendDomain() {
            try {
                const response = await fetch('http://localhost:8080/web/domain');
                const data = await response.json();
                if (data.message === 'Success.' && data.data) {
                    backendUrl = data.data;
                    console.log('Backend URL:', backendUrl);
                    return backendUrl;
                }
                throw new Error('Failed to fetch backend domain');
            } catch (error) {
                console.error('Error fetching backend domain:', error);
                backendUrl = 'http://localhost:8080'; // fallback
                console.warn('Using fallback backend URL:', backendUrl);
                return backendUrl;
            }
        }

        async function fetchAppInfo() {
            if (!backendUrl) {
                await fetchBackendDomain(); // Ensure backendUrl is set
            }
            try {
                const response = await fetch(`${backendUrl}/web/infor`);
                const data = await response.json();
                if (data.message === 'Success.' && data.data) {
                    appInfo = data.data;
                    console.log('App Info:', appInfo);
                    updatePageWithAppInfo();
                    return appInfo;
                }
                throw new Error('Failed to fetch app info');
            } catch (error) {
                console.error('Error fetching app info:', error);
                appInfo = {
                    webName: 'URLto',
                    gitHub: 'ShyDev',
                    author: 'https://github.com/dargits'
                };
                updatePageWithAppInfo();
                return appInfo;
            }
        }

        // Function to update page with app info
        function updatePageWithAppInfo() {
            if (appInfo.webName) {
                const siteNames = document.querySelectorAll('#site-name');
                siteNames.forEach(el => el.textContent = appInfo.webName);

                const titleBase = currentLang === 'vi' ? 'T·∫°o Link' : 'Create Link';
                document.getElementById('page-title').textContent = `${appInfo.webName} - ${titleBase}`;

                const footerSiteName = document.getElementById('footer-site-name');
                if (footerSiteName) {
                    footerSiteName.textContent = appInfo.webName;
                }
            }

            if (appInfo.author && appInfo.gitHub) {
                const authorLink = document.getElementById('author-link');
                const githubName = document.getElementById('github-name');

                if (authorLink) {
                    authorLink.href = appInfo.author;
                }
                if (githubName) {
                    githubName.textContent = appInfo.gitHub;
                }
            }
            // Re-apply translation after appInfo might change dynamic text placeholders
            translatePage(currentLang);
        }

        document.addEventListener('DOMContentLoaded', async function () {
            // Initialize backend URL first, then app info
            await fetchBackendDomain();
            await fetchAppInfo(); // This will also call updatePageWithAppInfo and translatePage

            // Kh·ªüi t·∫°o ng√¥n ng·ªØ: ∆Øu ti√™n t·ª´ localStorage, sau ƒë√≥ l√† ng√¥n ng·ªØ tr√¨nh duy·ªát, cu·ªëi c√πng l√† 'vi'
            const storedLang = localStorage.getItem('preferredLang');
            const userLang = navigator.language.split('-')[0];
            currentLang = (storedLang && (storedLang === 'vi' || storedLang === 'en')) ? storedLang :
                ((userLang === 'vi' || userLang === 'en') ? userLang : 'vi');
            translatePage(currentLang); // Ensure initial translation applies after appInfo is loaded


            // Shortcode generation logic
            const longUrlInput = document.getElementById('longUrl');
            const customShortCodeInput = document.getElementById('customShortCode');
            const shortenButton = document.getElementById('shortenButton');
            const loadingIndicator = document.getElementById('loadingIndicator');
            const errorMessageDiv = document.getElementById('errorMessage');
            const successMessageDiv = document.getElementById('successMessage');
            const shortenedUrlOutput = document.getElementById('shortenedUrlOutput');
            const copyButton = document.getElementById('copyButton');

            // L·∫•y BACK_END_DOMAIN t·ª´ Webcontants.java v√† LINK_API_V1_PATH
            const LINK_API_PATH = "/api/v1/link";
            const SHORTEN_URL_ENDPOINT = `${backendUrl}${LINK_API_PATH}/create`;


            shortenButton.addEventListener('click', async () => {
                const originalUrl = longUrlInput.value.trim();
                const customShortCode = customShortCodeInput.value.trim();

                // Reset tr·∫°ng th√°i
                errorMessageDiv.style.display = 'none';
                successMessageDiv.style.display = 'none';
                errorMessageDiv.textContent = '';
                shortenedUrlOutput.value = '';

                if (!originalUrl) {
                    errorMessageDiv.textContent = translatableElements['vui-long-nhap-url-goc'][currentLang];
                    errorMessageDiv.style.display = 'block';
                    return;
                }

                // Ki·ªÉm tra ƒë·ªãnh d·∫°ng URL c∆° b·∫£n
                try {
                    new URL(originalUrl);
                } catch (e) {
                    errorMessageDiv.textContent = translatableElements['url-goc-khong-hop-le'][currentLang];
                    errorMessageDiv.style.display = 'block';
                    return;
                }

                shortenButton.disabled = true;
                shortenButton.classList.add('loading');
                loadingIndicator.style.display = 'block';
                shortenButton.innerHTML = `<i class="fas fa-spinner fa-spin mr-2"></i> ${translatableElements['dang-xu-ly'][currentLang]}`;


                const requestBody = {
                    originalLink: originalUrl
                };
                if (customShortCode) {
                    requestBody.customShortCode = customShortCode;
                }

                // Retrieve JWT token from localStorage
                const jwtToken = localStorage.getItem('jwt_token');
                if (!jwtToken) {
                    errorMessageDiv.textContent = 'B·∫°n ch∆∞a ƒëƒÉng nh·∫≠p ho·∫∑c phi√™n ƒë√£ h·∫øt h·∫°n. Vui l√≤ng ƒëƒÉng nh·∫≠p l·∫°i.';
                    errorMessageDiv.style.display = 'block';
                    shortenButton.disabled = false;
                    shortenButton.classList.remove('loading');
                    loadingIndicator.style.display = 'none';
                    shortenButton.innerHTML = `<i class="fas fa-compress-alt mr-2"></i> ${translatableElements['rut-gon-link'][currentLang]}`;
                    // Optionally, redirect to login page
                    // setTimeout(() => { window.location.href = `${backendUrl}/auth/login`; }, 2000);
                    return;
                }


                try {
                    const response = await fetch(SHORTEN_URL_ENDPOINT, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${jwtToken}`
                        },
                        body: JSON.stringify(requestBody)
                    });

                    const data = await response.json();

                    if (response.ok) { // HTTP status 2xx (Success)
                        let generatedShortCode = '';
                        if (data.data) {
                            generatedShortCode = data.data;
                        } else {
                            console.error("Unexpected successful response structure:", data);
                            errorMessageDiv.textContent = translatableElements['da-rut-gon-link-nhung-khong-tim-thay-shortcode'][currentLang];
                            errorMessageDiv.style.display = 'block';
                            return;
                        }

                        const fullShortenedUrl = `${backendUrl}/${generatedShortCode}`;
                        shortenedUrlOutput.value = fullShortenedUrl;
                        successMessageDiv.style.display = 'block';
                        longUrlInput.value = ''; // X√≥a URL g·ªëc sau khi r√∫t g·ªçn th√†nh c√¥ng
                        customShortCodeInput.value = ''; // X√≥a m√£ t√πy ch·ªânh
                    } else {
                        // X·ª≠ l√Ω ph·∫£n h·ªìi l·ªói
                        let errorMessage = translatableElements['da-xay-ra-loi-khong-xac-dinh'][currentLang];
                        if (data && data.message) { // Common case for ErrorResponse
                            errorMessage = data.message;
                        } else if (data && data.error) { // Fallback for generic error field
                            errorMessage = data.error;
                        }
                        errorMessageDiv.textContent = errorMessage;
                        errorMessageDiv.style.display = 'block';

                        // If it's an authentication error (e.g., 401 Unauthorized), clear token and redirect
                        if (response.status === 401 || response.status === 403) {
                            localStorage.removeItem('jwt_token'); // Clear invalid token
                            setTimeout(() => {
                                window.location.href = `${backendUrl}/auth/login`; // Redirect to login
                            }, 1500);
                        }
                    }
                } catch (error) {
                    console.error('L·ªói khi g·ª≠i y√™u c·∫ßu r√∫t g·ªçn link:', error);
                    errorMessageDiv.textContent = translatableElements['khong-the-ket-noi-den-may-chu'][currentLang];
                    errorMessageDiv.style.display = 'block';
                } finally {
                    shortenButton.disabled = false;
                    shortenButton.classList.remove('loading');
                    loadingIndicator.style.display = 'none';
                    shortenButton.innerHTML = `<i class="fas fa-compress-alt mr-2"></i> ${translatableElements['rut-gon-link'][currentLang]}`;
                }
            });

            copyButton.addEventListener('click', () => {
                shortenedUrlOutput.select();
                document.execCommand('copy');
                copyButton.textContent = translatableElements['sao-chep'][currentLang];
                setTimeout(() => {
                    copyButton.innerHTML = `<i class="fas fa-copy"></i> ${translatableElements['sao-chep'][currentLang]}`;
                }, 2000);
            });


            // --- Navigation Link Handlers ---
            // Generic function for navigation actions
            function setupNavLink(id, relativePath) {
                const link = document.getElementById(id);
                if (link) {
                    link.addEventListener('click', async (e) => {
                        e.preventDefault();
                        if (backendUrl) {
                            window.location.href = `${backendUrl}${relativePath}`;
                        } else {
                            console.error('Backend URL not available for navigation.');
                        }
                    });
                }
            }

            // Mapped to WebControler.java
            setupNavLink('nav-dashboard', '/dashboard');
            setupNavLink('mobile-nav-dashboard', '/dashboard');

            // New link for Create Link page
            setupNavLink('nav-create-link', '/create-link');
            setupNavLink('mobile-nav-create-link', '/create-link');


            setupNavLink('nav-payout-rates', '/payout-rates');
            setupNavLink('mobile-nav-payout-rates', '/payout-rates');

            setupNavLink('nav-logout', '/auth/logout');
            setupNavLink('mobile-nav-logout', '/auth/logout');

            // Keep as placeholders if no direct WebController mapping is found
            document.getElementById('nav-manage-links')?.addEventListener('click', (e) => e.preventDefault());
            document.getElementById('mobile-nav-manage-links')?.addEventListener('click', (e) => e.preventDefault());
            document.getElementById('nav-statistics')?.addEventListener('click', (e) => e.preventDefault());
            document.getElementById('mobile-nav-statistics')?.addEventListener('click', (e) => e.preventDefault());
            document.getElementById('nav-settings')?.addEventListener('click', (e) => e.preventDefault());
            document.getElementById('mobile-nav-settings')?.addEventListener('click', (e) => e.preventDefault());


            // Mobile Menu Logic (from index.html)
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const closeMobileMenuButton = document.getElementById('close-mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');

            if (mobileMenuButton && mobileMenu && closeMobileMenuButton) {
                mobileMenuButton.addEventListener('click', () => {
                    mobileMenu.classList.add('is-active');
                });

                closeMobileMenuButton.addEventListener('click', () => {
                    mobileMenu.classList.remove('is-active');
                });

                mobileMenu.addEventListener('click', (e) => {
                    if (e.target === mobileMenu) { // Close if clicked on the overlay itself
                        mobileMenu.classList.remove('is-active');
                    }
                });
            }

            // Toggle language dropdown for desktop (from index.html)
            const languageButtonDesktop = document.getElementById('language-button-desktop');
            const languageDropdownDesktop = document.getElementById('language-dropdown-desktop');

            if (languageButtonDesktop && languageDropdownDesktop) {
                languageButtonDesktop.addEventListener('click', (event) => {
                    languageDropdownDesktop.classList.toggle('is-active');
                    event.stopPropagation(); // Prevent document click from immediately closing
                });

                languageDropdownDesktop.querySelectorAll('a.language-item').forEach(link => {
                    link.addEventListener('click', (event) => {
                        event.preventDefault();
                        const lang = link.getAttribute('data-lang');
                        translatePage(lang);
                        languageDropdownDesktop.classList.remove('is-active');
                        event.stopPropagation(); // Prevent document click from closing it after selection
                    });
                });

                // Close dropdown if clicked outside
                document.addEventListener('click', (event) => {
                    if (!languageDropdownDesktop.contains(event.target) && !languageButtonDesktop.contains(event.target)) {
                        languageDropdownDesktop.classList.remove('is-active');
                    }
                });
            }

            // Toggle language dropdown for mobile (from index.html)
            const languageButtonMobile = document.getElementById('language-button-mobile');
            const languageDropdownMobile = document.getElementById('language-dropdown-mobile');

            if (languageButtonMobile && languageDropdownMobile) {
                languageButtonMobile.addEventListener('click', (event) => {
                    languageDropdownMobile.classList.toggle('is-active');
                    event.stopPropagation();
                });

                languageDropdownMobile.querySelectorAll('a.language-item').forEach(link => {
                    link.addEventListener('click', (event) => {
                        event.preventDefault();
                        const lang = link.getAttribute('data-lang');
                        translatePage(lang);
                        languageDropdownMobile.classList.remove('is-active');
                        mobileMenu.classList.remove('is-active'); // Close mobile menu if language selected within it
                        event.stopPropagation();
                    });
                });

                // Close dropdown if clicked outside its area or mobile menu.
                document.addEventListener('click', (event) => {
                    const isClickInsideMobileMenu = mobileMenu.contains(event.target);
                    const isClickOnMobileLangButton = languageButtonMobile.contains(event.target);
                    const isClickInsideMobileLangDropdown = languageDropdownMobile.contains(event.target);

                    if (!isClickOnMobileLangButton && !isClickInsideMobileLangDropdown) {
                        languageDropdownMobile.classList.remove('is-active');
                    }
                });
            }
        });
    </script>
</body>

</html>